
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Virtual Pet</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
  
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0"
      />
      <link
        rel="stylesheet"
        href="{% static 'map.css' %}?{% now 'U' %}"
      />
      <link
        rel="stylesheet"
        type="text/css"
        href="https://unpkg.com/leaflet/dist/leaflet.css"
        crossorigin=""
      />
      <script
        src="https://unpkg.com/leaflet/dist/leaflet.js"
        crossorigin=""
      ></script>
      <script 
      src="https://kit.fontawesome.com/f32a47c063.js" 
      crossorigin="anonymous">
    </script>
    
    <style>
      .main-page-map {
    
        padding-top: 100px;
        height:300px;
        background-color:  rgb(26,68,115);
        background-image: linear-gradient(to right, purple,rgb(80,68,100), rgb(26,68,115));
        
      }
      .action-button {
        overflow:hidden;
        margin: 10px 20px;
        display: inline-block;
        padding: 8px 20px;
        color: white;
        font-size: 15px;
        font-weight: bold;
        background: rgba(255, 118, 081, 0.5); /* Translucent white background */
        border: 3px solid;
        border-radius: 99px; 
        font-family: Arial, Helvetica, sans-serif;
      }
      p{
        position:absolute;
        width:100%;
        display:flex;
        color:white;
      }
      .button-container {
        position:absolute;
        padding-top: 20px;
        display: flex;
        justify-content: right; 
        align-items: top; 
        width: 100%; 
        flex-direction: row;
        gap: 10px; 
      }
    </style>
</head>
<body>
  {% include "../trashpetapp/navbar.html" %}

  <!-- Highlight tab on navbar -->
  <script>
    document.getElementById("home-tab").classList.remove("active")
    document.getElementById("garden-tab").classList.remove("active")
    document.getElementById("shop-tab").classList.remove("active")

    document.getElementById("map-tab").classList.add("active")
    document.getElementById("camera-tab").classList.remove("active")
    
  </script>

  
  <div class="main-page-map">
    <p style="text-align: left;"><a id="Distance">temp distance</a></p>
    <div class="button-container">
      <p style="justify-content: right; padding-right: 150px;" id="leavesCounterContainer">
        <!-- Leaf icon -->
        <i class="fa-solid fa-leaf"></i>:
        <span id="leavesCounter">
          <!-- Django reference -->
          {{ leaves }}
        </span>
      </p>
      <p style="text-align: left;">
        <a id="Time">temp time</a>
      </p>
      <div class="button-container">
        <button id="stop" class="action-button">Stop Tracking</button>
        <button id="start-stop" class="action-button">Start Walking</button>
      </div>
    </div>
  </div>
  
  <div id="map"></div>
  <script
    src="{% static 'map.js' %}"
    {% for marker in markers %}
            L.marker([{{ marker.latitude }}, {{ marker.longitude }}]).addTo(map)
                .bindPopup("{{ marker.name }}");
    {% endfor %}
  ></script>
  <script>

      //script to update leaves count in database and on screen
      $(document).ready(function() {
          $('#stop-start').click(function() {
              console.log("BAKSH");
              if ($('#start-stop').text() == "Stop Walking") {
  
                  // Get the current number of leaves from the div
                  var currentLeaves = parseInt($('#leavesCounter').text().trim());
  
                  // Get the distance travelled from the global variable
                  var distance = window.distanceTravelled;
  
                  // Calculate the number of leaves a person has earned
                  var updateLeavesValues = Math.trunc(distance * 10);
  
                  // Update the leaves value using AJAX
                  $.ajax({
                      // URL to Django view for updating leaves
                      url: '{% url "update_leaves" %}',
                      method: 'POST',
                      headers: { 'X-CSRFToken': getCookie('csrftoken') },
                      // Increment the leaves value by the calculated updateLeavesValues
                      data: { 'new_leaves': currentLeaves + updateLeavesValues },
                      success: function(response) {
                          // Update the leaves value displayed in the leavesCounter div
                          $('#leavesCounter').text(response.new_leaves);
                          // Log success in console
                          console.log('Leaves updated successfully.');
                          console.log('Leaves value: ', response.new_leaves);
                      },
                      error: function(xhr, status, error) {
                          // Error message if request fails
                          console.error('Error updating leaves:', error);
                      }
                  });
              }
          });
      });
  </script>
  
      

          
   

</body>
</html>