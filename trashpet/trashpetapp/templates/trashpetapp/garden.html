{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Virtual Pet</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'garden.css' %}">
    <script src="https://kit.fontawesome.com/f32a47c063.js" crossorigin="anonymous"></script>

    <style>
        body{
          background: url('{% static "gardenBackground.jpg" %}') rgba(0,0,0,0.3);
          background-blend-mode: multiply;
          background-position: center;
          background-size: 100% 100%;
          background-repeat: no-repeat;
          /*background-color: rgb(218, 186, 139) !important;*/
        }
        .text{
          text-align: center;
          padding-top: 100px;
        }
        .user-output{
          text-align: center;
          margin-top: 50px;
        }
        #pet-container {
          position: relative;
          width: 200px;
          height: 200px;
          overflow: hidden;
        }

        .pet-background,
        .pet-eyes,
        .pet-smile {
            max-width: 100%;
            max-height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .pet-layered-item {
          position: absolute;
          max-width: 100%;
          max-height: 100%;
          z-index: 2;
          top: 0;
          left: 0;
        }
    </style>
</head>
<body>
  {% include "../trashpetapp/navbar.html" %}

  <!-- Highlight tab on navbar -->
  <script>
    document.getElementById("home-tab").classList.remove("active")
    document.getElementById("garden-tab").classList.remove("active")
    document.getElementById("shop-tab").classList.remove("active")
    document.getElementById("map-tab").classList.remove("active")

    document.getElementById("garden-tab").classList.add("active")

  </script>

  <div class="main-page-garden">

    <div class="text">
      <h1>The Garden</h1>
    </div>
    

    <div id="pet-container">
      <img src= '{% static "images/petbackground.png" %}'  class="pet-background" alt="pet">
      <img id="eyes" src='{% static "/images/closedeyes.png" %}'class="pet-eyes" alt="pet">
      <img src = '{% static "/images/smile.png" %}' class="pet-smile" alt="pet">
  </div>
  <div class="buttons-container">
      <button id="feed-button">Feed</button>
      <button id="play-button">Play</button>
      <button id="bin-button">bin</button>
  </div>

    <div id="plant-container">
      <img src="{% static 'images/plant1.png' %}" class="plant-image" id="plant-image">
    </div>
    
    <div id="leavesCounterContainer">
      <i class="fa-solid fa-leaf"></i>:
      <div id = "leavesCounter">
        {{leaves}}
      </div>
    </div>

    <script src="{% static 'garden.js' %}"></script>
    <script src="{% static 'animate.js' %}"></script>
    <script src="{% static 'jquery.min.js' %}"></script>
  </div>
  
  <script>
    //script to update leaves count in database and on screen
    $(document).ready(function() {
            $('#bin-button').click(function() {
                // Get the current number of leaves from the div
                var currentLeaves = parseInt($('#leavesCounter').text().trim());
                
                function getCookie(name) {
                    var cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                } 

                // Update the leaves value using AJAX
                $.ajax({
                    url: '{% url "update_leaves" %}',  // URL to Django view for updating leaves
                    method: 'POST',
                    headers: { 'X-CSRFToken': getCookie('csrftoken')},
                    data: {'new_leaves': currentLeaves + 1},  // Increment the leaves value by 1
                    success: function(response) {
                        // Update the leaves value displayed in the leavesCounter div
                        $('#leavesCounter').text(response.new_leaves);
                        console.log('Leaves updated successfully.');
                        console.log('leaves value: ', response.new_leaves);
                    },
                    error: function(xhr, status, error) {
                        console.error('Error updating leaves:', error);
                    }
                });
            });
        });
  </script>

</body>
</html>